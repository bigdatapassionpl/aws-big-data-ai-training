{"paragraphs":[{"text":"%md\nThis notebook uses the K-Means built-in algorithm in Amazon SageMaker to cluster the MNIST data set.","user":"anonymous","dateUpdated":"2018-05-07T11:33:51+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>This notebook uses the K-Means built-in algorithm in Amazon SageMaker to cluster the MNIST data set.</p>\n"}]},"apps":[],"jobName":"paragraph_1525692556707_-1831098300","id":"20180507-112916_2106231845","dateCreated":"2018-05-07T11:29:16+0000","dateStarted":"2018-05-07T11:30:00+0000","dateFinished":"2018-05-07T11:30:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1024"},{"title":"Import Spark classes","text":"import org.apache.spark.sql.SparkSession\nimport com.amazonaws.services.sagemaker.sparksdk.{IAMRole,SageMakerResourceCleanup}\nimport com.amazonaws.services.sagemaker.sparksdk.algorithms.KMeansSageMakerEstimator\nimport com.amazonaws.services.sagemaker.AmazonSageMakerClientBuilder","user":"anonymous","dateUpdated":"2018-05-07T12:07:03+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.SparkSession\nimport com.amazonaws.services.sagemaker.sparksdk.{IAMRole, SageMakerResourceCleanup}\nimport com.amazonaws.services.sagemaker.sparksdk.algorithms.KMeansSageMakerEstimator\nimport com.amazonaws.services.sagemaker.AmazonSageMakerClientBuilder\n"}]},"apps":[],"jobName":"paragraph_1525692321098_-1007471854","id":"20180507-112521_1429704532","dateCreated":"2018-05-07T11:25:21+0000","dateStarted":"2018-05-07T11:47:00+0000","dateFinished":"2018-05-07T11:47:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1025"},{"text":"val spark = SparkSession.builder.getOrCreate\nval region = \"us-east-1\"\nval roleArn = \"arn:aws:iam::ACCOUNT_NUMBER:role/ROLE_NAME\"","user":"anonymous","dateUpdated":"2018-05-07T11:28:45+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"spark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@2d4cf021\nregion: String = us-east-1\nroleArn: String = arn:aws:iam::ACCOUNT_NUMBER:role/ROLE_NAME\n"}]},"apps":[],"jobName":"paragraph_1525692361777_334978356","id":"20180507-112601_921096368","dateCreated":"2018-05-07T11:26:01+0000","dateStarted":"2018-05-07T11:28:45+0000","dateFinished":"2018-05-07T11:28:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1026"},{"title":"Load MNIST data set","text":"// The data set is in libsvm format: 28x28 images have been converted to 784-byte vectors.\nval trainingData = spark.read.format(\"libsvm\").option(\"numFeatures\", \"784\").load(s\"s3://sagemaker-sample-data-$region/spark/mnist/train/\")\nval testData = spark.read.format(\"libsvm\").option(\"numFeatures\", \"784\").load(s\"s3://sagemaker-sample-data-$region/spark/mnist/test/\")\n\ntrainingData.count\ntrainingData.show","user":"anonymous","dateUpdated":"2018-05-07T11:31:10+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"trainingData: org.apache.spark.sql.DataFrame = [label: double, features: vector]\ntestData: org.apache.spark.sql.DataFrame = [label: double, features: vector]\nres601: Long = 60000\n+-----+--------------------+\n|label|            features|\n+-----+--------------------+\n|  5.0|(784,[152,153,154...|\n|  0.0|(784,[127,128,129...|\n|  4.0|(784,[160,161,162...|\n|  1.0|(784,[158,159,160...|\n|  9.0|(784,[208,209,210...|\n|  2.0|(784,[155,156,157...|\n|  1.0|(784,[124,125,126...|\n|  3.0|(784,[151,152,153...|\n|  1.0|(784,[152,153,154...|\n|  4.0|(784,[134,135,161...|\n|  3.0|(784,[123,124,125...|\n|  5.0|(784,[216,217,218...|\n|  3.0|(784,[143,144,145...|\n|  6.0|(784,[72,73,74,99...|\n|  1.0|(784,[151,152,153...|\n|  7.0|(784,[211,212,213...|\n|  2.0|(784,[151,152,153...|\n|  8.0|(784,[159,160,161...|\n|  6.0|(784,[100,101,102...|\n|  9.0|(784,[209,210,211...|\n+-----+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1525692380211_-1994844800","id":"20180507-112620_1169261233","dateCreated":"2018-05-07T11:26:20+0000","dateStarted":"2018-05-07T11:28:45+0000","dateFinished":"2018-05-07T11:28:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1027"},{"title":"Configure training job","text":"val estimator = new KMeansSageMakerEstimator(\n    sagemakerRole = IAMRole(roleArn), \n    trainingInstanceType = \"ml.p2.xlarge\", trainingInstanceCount = 1, \n    endpointInstanceType = \"ml.c4.xlarge\", endpointInitialInstanceCount = 1)\n   \nestimator.setK(10).setFeatureDim(784)","user":"anonymous","dateUpdated":"2018-05-07T11:31:28+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"estimator: com.amazonaws.services.sagemaker.sparksdk.algorithms.KMeansSageMakerEstimator = sagemaker_6fb2ff07df12\nres604: estimator.type = sagemaker_6fb2ff07df12\n"}]},"apps":[],"jobName":"paragraph_1525692416648_-1901289521","id":"20180507-112656_2006563547","dateCreated":"2018-05-07T11:26:56+0000","dateStarted":"2018-05-07T11:28:46+0000","dateFinished":"2018-05-07T11:28:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1028"},{"title":"Train on SageMaker","text":"val model = estimator.fit(trainingData)","user":"anonymous","dateUpdated":"2018-05-07T11:31:42+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"model: com.amazonaws.services.sagemaker.sparksdk.SageMakerModel = sagemaker_6fb2ff07df12\n"}]},"apps":[],"jobName":"paragraph_1525692431021_1591476318","id":"20180507-112711_180509339","dateCreated":"2018-05-07T11:27:11+0000","dateStarted":"2018-05-07T11:28:48+0000","dateFinished":"2018-05-07T11:38:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1029"},{"title":"Predict test data set","text":"val transformedData = model.transform(testData)\ntransformedData.show","user":"anonymous","dateUpdated":"2018-05-07T11:31:54+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"transformedData: org.apache.spark.sql.DataFrame = [label: double, features: vector ... 2 more fields]\n+-----+--------------------+-------------------+---------------+\n|label|            features|distance_to_cluster|closest_cluster|\n+-----+--------------------+-------------------+---------------+\n|  7.0|(784,[202,203,204...| 1400.2491455078125|            5.0|\n|  2.0|(784,[94,95,96,97...|   1991.92529296875|            9.0|\n|  1.0|(784,[128,129,130...|  965.8948974609375|            4.0|\n|  0.0|(784,[124,125,126...| 1574.7559814453125|            6.0|\n|  4.0|(784,[150,151,159...|  1499.984130859375|            0.0|\n|  1.0|(784,[156,157,158...| 1015.7600708007812|            4.0|\n|  4.0|(784,[149,150,151...| 1672.7237548828125|            0.0|\n|  9.0|(784,[179,180,181...| 1647.6636962890625|            0.0|\n|  5.0|(784,[129,130,131...|  2077.906982421875|            0.0|\n|  9.0|(784,[209,210,211...| 1457.4090576171875|            5.0|\n|  0.0|(784,[123,124,125...| 1608.7972412109375|            6.0|\n|  6.0|(784,[94,95,96,97...|    1992.6142578125|            2.0|\n|  9.0|(784,[208,209,210...| 1360.8345947265625|            0.0|\n|  0.0|(784,[152,153,154...| 1599.6151123046875|            6.0|\n|  1.0|(784,[125,126,127...|  901.6956176757812|            4.0|\n|  5.0|(784,[124,125,126...| 1787.2122802734375|            7.0|\n|  9.0|(784,[179,180,181...|    1380.7216796875|            0.0|\n|  7.0|(784,[200,201,202...|      1797.51171875|            0.0|\n|  3.0|(784,[118,119,120...|   2184.13330078125|            7.0|\n|  4.0|(784,[158,159,185...| 1229.5648193359375|            0.0|\n+-----+--------------------+-------------------+---------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1525692469981_1108109106","id":"20180507-112749_1456945891","dateCreated":"2018-05-07T11:27:49+0000","dateStarted":"2018-05-07T11:28:48+0000","dateFinished":"2018-05-07T11:38:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1030"},{"title":"Cleanup","text":"val sagemakerClient = AmazonSageMakerClientBuilder.defaultClient\nval cleanup = new SageMakerResourceCleanup(sagemakerClient)\n//cleanup.deleteResources(model.getCreatedResources)","user":"anonymous","dateUpdated":"2018-05-07T11:47:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sagemakerClient: com.amazonaws.services.sagemaker.AmazonSageMaker = com.amazonaws.services.sagemaker.AmazonSageMakerClient@7bd8d712\ncleanup: com.amazonaws.services.sagemaker.sparksdk.SageMakerResourceCleanup = com.amazonaws.services.sagemaker.sparksdk.SageMakerResourceCleanup@a413063\n"}]},"apps":[],"jobName":"paragraph_1525692314874_-1418014254","id":"20180507-112514_1443140595","dateCreated":"2018-05-07T11:25:14+0000","dateStarted":"2018-05-07T11:47:04+0000","dateFinished":"2018-05-07T11:47:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1031"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525692525146_-1280183847","id":"20180507-112845_1387262564","dateCreated":"2018-05-07T11:28:45+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1032"}],"name":"Clustering MNIST with the built-in K-Means algorithm in Amazon SageMaker (Scala)","id":"2DDJ6FF2T","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}
